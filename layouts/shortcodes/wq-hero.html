{{/* =========================================================
WQ HERO (Stable)
Path: layouts/shortcodes/wq-hero.html

✅ Features:
- Avatar + Name + Subtitle (学习/笔记/代码/Mac 工具)
- GitHub-style decorative heatmap (not tied to post frequency)
- Heatmap inside text: "Hello, World." (required)
- Small rotating slogans (fade transition)
- Light/Dark mode support (html.dark)
- No outer heavy border; clean alignment

✅ How to customize:
- Search: [WQ_CUSTOM] blocks
========================================================= */}}

{{/* -------------------------
[WQ_CUSTOM] 基础信息（你可改）
-------------------------- */}}
{{- $name := .Get "name" | default "WangQing" -}}
{{- $subtitle := .Get "subtitle" | default "学习笔记 · 代码实践 · Mac 工具与教程分享" -}}

{{/* 头像：建议放 static/avatar/cartoon.png 之类，然后传参 avatar="/avatar/cartoon.png" */}}
{{- $avatar := .Get "avatar" | default "/avatar.png" -}}

{{/* 热力图配色：blue 或 green（默认 blue） */}}
{{- $palette := .Get "palette" | default "blue" -}}

<div class="wq-hero" data-palette="{{ $palette | htmlEscape }}">
  <div class="wq-hero-top">
    <div class="wq-hero-avatar">
      <img src="{{ $avatar | safeURL }}" alt="avatar" loading="lazy" />
    </div>

    <div class="wq-hero-meta">
      <div class="wq-hero-name">{{ $name }}</div>
      <div class="wq-hero-sub">{{ $subtitle }}</div>
    </div>
  </div>

  <div class="wq-hero-say">
    <span class="wq-pill">Today</span>
    <span class="wq-say-text" id="wqSayText">Hello, World.</span>
  </div>

  <div class="wq-hero-divider"></div>

  <div class="wq-heat-head">
    <div class="wq-heat-title">Heatmap</div>
    <div class="wq-heat-note">（视觉装饰，不绑定发文频率）</div>
  </div>

  <div class="wq-heat-wrap">
    <div class="wq-heat-grid" id="wqHeatGrid" aria-hidden="true"></div>

    <!-- 热力图内文字（必备） -->
    <div class="wq-heat-watermark">
      <div class="wq-heat-watermark-main">Hello, World.</div>
      <div class="wq-heat-watermark-sub" id="wqHeatRotator">Keep shipping.</div>
    </div>
  </div>

  <div class="wq-heat-legend">
    <span class="wq-legend-less">Less</span>
    <span class="wq-legend-dots">
      <i></i><i></i><i></i><i></i><i></i>
    </span>
    <span class="wq-legend-more">More</span>
  </div>
</div>

<style>
/* =========================
   WQ HERO Styles
   ========================= */

/* [WQ_CUSTOM] 你想整体更宽/更窄：改这里 */
.wq-hero{
  margin: 18px 0 10px;
  padding: 0;                 /* ✅ 取消“外层框框感” */
  max-width: 920px;           /* ✅ 与内容区对齐 */
}

/* 顶部布局 */
.wq-hero-top{
  display:flex;
  align-items:center;
  gap: 18px;
}

/* 头像 */
.wq-hero-avatar{
  width: 72px;
  height: 72px;
  border-radius: 999px;
  overflow:hidden;
  flex: 0 0 auto;
  background: rgba(255,255,255,.6);
  border: 1px solid rgba(0,0,0,.10);
}
html.dark .wq-hero-avatar{
  background: rgba(255,255,255,.06);
  border-color: rgba(255,255,255,.12);
}
.wq-hero-avatar img{
  width:100%;
  height:100%;
  object-fit: cover;
  display:block;
}

/* 名称 & 简介 */
.wq-hero-meta{ min-width:0; }
.wq-hero-name{
  font-weight: 900;
  font-size: 34px;
  line-height: 1.12;
  letter-spacing: -0.02em;
  color: rgba(15,23,42,.94);
}
html.dark .wq-hero-name{ color: rgba(255,255,255,.92); }

.wq-hero-sub{
  margin-top: 6px;
  font-size: 16px;
  line-height: 1.5;
  color: rgba(100,116,139,1);
  white-space: nowrap;
  overflow:hidden;
  text-overflow: ellipsis;
}
html.dark .wq-hero-sub{ color: rgba(209,213,219,.72); }

/* Today + 文案 */
.wq-hero-say{
  margin-top: 18px;
  display:flex;
  align-items:center;
  gap: 12px;
}
.wq-pill{
  display:inline-flex;
  align-items:center;
  padding: 6px 12px;
  border-radius: 999px;
  background: rgba(148,163,184,.18);
  color: rgba(100,116,139,1);
  font-weight: 800;
  font-size: 14px;
}
html.dark .wq-pill{
  background: rgba(255,255,255,.08);
  color: rgba(209,213,219,.72);
}
.wq-say-text{
  font-size: 28px;
  font-weight: 900;
  letter-spacing: -0.01em;
  color: rgba(15,23,42,.92);
  transition: opacity .35s ease, transform .35s ease;
}
html.dark .wq-say-text{ color: rgba(255,255,255,.92); }

/* 分隔线 */
.wq-hero-divider{
  margin: 18px 0 18px;
  height: 1px;
  background: rgba(0,0,0,.06);
}
html.dark .wq-hero-divider{ background: rgba(255,255,255,.10); }

/* Heatmap 标题行 */
.wq-heat-head{
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap: 12px;
}
.wq-heat-title{
  font-weight: 900;
  font-size: 18px;
  color: rgba(15,23,42,.92);
}
html.dark .wq-heat-title{ color: rgba(255,255,255,.92); }
.wq-heat-note{
  font-size: 14px;
  color: rgba(100,116,139,1);
}
html.dark .wq-heat-note{ color: rgba(209,213,219,.72); }

/* Heatmap 容器（轻微圆角，不做“外框卡片”） */
.wq-heat-wrap{
  margin-top: 12px;
  position: relative;
  border-radius: 18px;
  padding: 14px 14px 14px;
  background: rgba(148,163,184,.10);
  border: 1px solid rgba(0,0,0,.06);
  overflow:hidden;
}
html.dark .wq-heat-wrap{
  background: rgba(255,255,255,.06);
  border-color: rgba(255,255,255,.10);
}

/* 网格：53 周 x 7 天 */
.wq-heat-grid{
  display:grid;
  grid-template-columns: repeat(53, 12px);
  grid-auto-rows: 12px;
  gap: 6px;
  align-items:center;
  justify-content:flex-start;
  user-select:none;
  -webkit-user-select:none;
  opacity: 1;
}

/* 单个格子 */
.wq-heat-grid i{
  width: 12px;
  height: 12px;
  border-radius: 4px;
  display:block;
  background: rgba(148,163,184,.28);              /* ✅ 暗色/浅色都有可见底色 */
}
html.dark .wq-heat-grid i{
  background: rgba(255,255,255,.10);              /* ✅ 暗色模式也能看到“点” */
}

/* 强度色阶：蓝/绿两套 */
.wq-hero[data-palette="blue"] .wq-heat-grid i.l1{ background: rgba(59,130,246,.22); }
.wq-hero[data-palette="blue"] .wq-heat-grid i.l2{ background: rgba(59,130,246,.36); }
.wq-hero[data-palette="blue"] .wq-heat-grid i.l3{ background: rgba(59,130,246,.55); }
.wq-hero[data-palette="blue"] .wq-heat-grid i.l4{ background: rgba(59,130,246,.78); }

.wq-hero[data-palette="green"] .wq-heat-grid i.l1{ background: rgba(34,197,94,.22); }
.wq-hero[data-palette="green"] .wq-heat-grid i.l2{ background: rgba(34,197,94,.36); }
.wq-hero[data-palette="green"] .wq-heat-grid i.l3{ background: rgba(34,197,94,.55); }
.wq-hero[data-palette="green"] .wq-heat-grid i.l4{ background: rgba(34,197,94,.78); }

/* 暗色模式下：强度色更亮一点点 */
html.dark .wq-hero[data-palette="blue"] .wq-heat-grid i.l1{ background: rgba(96,165,250,.18); }
html.dark .wq-hero[data-palette="blue"] .wq-heat-grid i.l2{ background: rgba(96,165,250,.32); }
html.dark .wq-hero[data-palette="blue"] .wq-heat-grid i.l3{ background: rgba(96,165,250,.52); }
html.dark .wq-hero[data-palette="blue"] .wq-heat-grid i.l4{ background: rgba(96,165,250,.74); }

html.dark .wq-hero[data-palette="green"] .wq-heat-grid i.l1{ background: rgba(74,222,128,.18); }
html.dark .wq-hero[data-palette="green"] .wq-heat-grid i.l2{ background: rgba(74,222,128,.32); }
html.dark .wq-hero[data-palette="green"] .wq-heat-grid i.l3{ background: rgba(74,222,128,.52); }
html.dark .wq-hero[data-palette="green"] .wq-heat-grid i.l4{ background: rgba(74,222,128,.74); }

/* 热力图内文字 */
.wq-heat-watermark{
  position:absolute;
  left: 16px;
  bottom: 14px;
  display:flex;
  flex-direction:column;
  gap: 6px;
  pointer-events:none;
}
.wq-heat-watermark-main{
  font-size: 13px;
  font-weight: 900;
  color: rgba(15,23,42,.72);
}
html.dark .wq-heat-watermark-main{
  color: rgba(255,255,255,.70);
}
.wq-heat-watermark-sub{
  font-size: 12px;
  font-weight: 750;
  color: rgba(100,116,139,1);
  transition: opacity .35s ease, transform .35s ease;
}
html.dark .wq-heat-watermark-sub{
  color: rgba(209,213,219,.70);
}

/* legend */
.wq-heat-legend{
  margin-top: 10px;
  display:flex;
  align-items:center;
  gap: 10px;
  color: rgba(100,116,139,1);
  font-size: 14px;
}
html.dark .wq-heat-legend{ color: rgba(209,213,219,.70); }
.wq-legend-dots{
  display:inline-flex;
  align-items:center;
  gap: 6px;
}
.wq-legend-dots i{
  width: 12px;
  height: 12px;
  border-radius: 4px;
  background: rgba(148,163,184,.28);
}
html.dark .wq-legend-dots i{ background: rgba(255,255,255,.10); }
.wq-legend-dots i:nth-child(2){ background: rgba(59,130,246,.22); }
.wq-legend-dots i:nth-child(3){ background: rgba(59,130,246,.36); }
.wq-legend-dots i:nth-child(4){ background: rgba(59,130,246,.55); }
.wq-legend-dots i:nth-child(5){ background: rgba(59,130,246,.78); }
.wq-hero[data-palette="green"] .wq-legend-dots i:nth-child(2){ background: rgba(34,197,94,.22); }
.wq-hero[data-palette="green"] .wq-legend-dots i:nth-child(3){ background: rgba(34,197,94,.36); }
.wq-hero[data-palette="green"] .wq-legend-dots i:nth-child(4){ background: rgba(34,197,94,.55); }
.wq-hero[data-palette="green"] .wq-legend-dots i:nth-child(5){ background: rgba(34,197,94,.78); }

/* 响应式：手机端堆叠 + 热力图自动缩 */
@media (max-width: 820px){
  .wq-hero{ max-width: 100%; }
  .wq-hero-top{ gap: 14px; }
  .wq-hero-name{ font-size: 28px; }
  .wq-hero-sub{ white-space: normal; }
  .wq-say-text{ font-size: 22px; }
  .wq-heat-grid{
    grid-template-columns: repeat(26, 12px);
  }
}
</style>

<script>
(function(){
  // 防止重复初始化（Hugo 有时会重复渲染）
  if (window.__WQ_HERO_INIT__) return;
  window.__WQ_HERO_INIT__ = true;

  // 1) 构建热力图格子（装饰，不绑定文章）
  var grid = document.getElementById("wqHeatGrid");
  if (grid) {
    var total = 53 * 7;
    var now = new Date();
    // 稳定伪随机：按日期 + index（保证“看起来有活跃度”，但不会太花）
    function level(i){
      var seed = (now.getFullYear()*10000 + (now.getMonth()+1)*100 + now.getDate()) + i*17;
      var r = Math.abs(Math.sin(seed) * 10000) % 1;
      // 让“空格子”为主
      if (r < 0.72) return 0;
      if (r < 0.84) return 1;
      if (r < 0.92) return 2;
      if (r < 0.97) return 3;
      return 4;
    }
    var frag = document.createDocumentFragment();
    for (var k=0; k<total; k++){
      var cell = document.createElement("i");
      var lv = level(k);
      if (lv) cell.className = "l" + lv;
      frag.appendChild(cell);
    }
    grid.innerHTML = "";
    grid.appendChild(frag);
  }

  // 2) 文案轮播（平滑淡入淡出）
  var sayEl = document.getElementById("wqSayText");
  var rotEl = document.getElementById("wqHeatRotator");

  // [WQ_CUSTOM] 文案池（Hello, World 必须出现）
  var slogans = [
    "Hello, World.",
    "Keep shipping.",
    "Write once, learn twice.",
    "Mac tips & dev notes.",
    "Build. Iterate. Share.",
    "Focus on small wins.",
    "今天也在写点东西。",
    "把复杂的事讲明白。"
  ];

  function pickNext(prev){
    if (slogans.length <= 1) return slogans[0];
    var next = prev;
    var guard = 0;
    while (next === prev && guard++ < 10){
      next = slogans[Math.floor(Math.random() * slogans.length)];
    }
    return next;
  }

  function fadeSwap(el, nextText){
    if (!el) return;
    el.style.opacity = "0";
    el.style.transform = "translateY(2px)";
    setTimeout(function(){
      el.textContent = nextText;
      el.style.opacity = "1";
      el.style.transform = "translateY(0)";
    }, 240);
  }

  var current = "Hello, World.";
  var current2 = "Keep shipping.";
  if (sayEl) sayEl.textContent = current;
  if (rotEl) rotEl.textContent = current2;

  // 每 4.5s 换一次（不“幻灯片硬切”）
  setInterval(function(){
    current = pickNext(current);
    current2 = pickNext(current2);
    fadeSwap(sayEl, current);
    fadeSwap(rotEl, current2);
  }, 4500);
})();
</script>