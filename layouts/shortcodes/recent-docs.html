{{- /* ==========================================
     WQ Recent Docs (Home)
     æ–‡ä»¶ï¼šlayouts/shortcodes/recent-docs.html
     è¯´æ˜ï¼šä¸»é¡µâ€œæœ€è¿‘æ›´æ–°â€æ¨¡å—ï¼ˆæ›´è´´åˆâ€œå…¨éƒ¨æ–‡ç« â€çš„æ’ç‰ˆï¼Œæ‰‹æœºç«¯æ ‡é¢˜æ›´å¥½è¯»ï¼‰
     å¯æ”¹å‚æ•°ï¼šè§ä¸‹æ–¹ $limit
========================================== */ -}}

{{- $limit := 5 -}} {{/* âœ… è¿™é‡Œæ”¹æ˜¾ç¤ºæ¡æ•° */}}
{{- with .Get "limit" -}}
  {{- $limit = (int .) -}}
{{- end -}}

{{- $docs := where site.RegularPages "Section" "docs" -}}
{{- $docs = $docs.ByDate.Reverse -}}

<style>
/* ===== æœ€è¿‘æ›´æ–°ï¼šè·Ÿâ€œå…¨éƒ¨æ–‡ç« â€åŒæ’ç‰ˆï¼Œä½†æ›´ç²¾ç®€ï¼ˆæ— é˜´å½±ï¼‰ ===== */
.wq-recent{
  margin-top: 14px;
}
.wq-recent-list{
  margin-top: 12px;
  display: grid;
  gap: 10px;
}

/* å•æ¡ï¼šæ— é˜´å½±ã€è½»è¾¹æ¡†ã€è½»åº•è‰² */
.wq-recent-item{
  position: relative;
  border: 1px solid rgba(0,0,0,.08);
  border-radius: 12px;
  padding: 10px 12px;
  background: rgba(255,255,255,.65);
  transition: background .15s ease, border-color .15s ease;
}

/* hover åªåšå¾ˆè½»çš„èƒŒæ™¯å˜åŒ– */
.wq-recent-item:hover{
  background: rgba(37,99,235,.03);
  border-color: rgba(37,99,235,.14);
}

/* é¡¶è¡Œï¼šæ›´æ–°äº + åˆ†äº« */
.wq-recent-top{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
}

/* æ—¶é—´ï¼šå’Œä½ æ–‡ç« åˆ—è¡¨ä¸€è‡´çš„â€œæ›´æ–°äºâ€é£æ ¼ */
.wq-recent-time{
  display:flex;
  align-items:center;
  gap: 8px;
  font-size: 12.5px;
  color: rgba(100,116,139,1);
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
}
.wq-recent-time .ico{
  font-size: 13px;
  opacity: .95;
}

/* åˆ†äº«æŒ‰é’®ï¼šå°å·ï¼Œåƒ GitHub Star çš„ä½“é‡ */
.wq-recent-copy{
  display:inline-flex;
  align-items:center;
  gap: 6px;
  padding: 3px 8px;
  border-radius: 999px;
  border: 1px solid rgba(0,0,0,.10);
  background: rgba(255,255,255,.60);
  color: rgba(15,23,42,.72);
  font-size: 12px;
  font-weight: 800;
  cursor: pointer;
  user-select:none;
  transition: background .15s ease, border-color .15s ease, color .15s ease;
}
.wq-recent-copy:hover{
  background: rgba(255,255,255,.86);
  border-color: rgba(0,0,0,.12);
  color: rgba(15,23,42,.78);
}
.wq-recent-copy .ico{ opacity:.85; }

/* ç¬¬äºŒè¡Œï¼šæ ‡é¢˜ï¼ˆå…è®¸æ¢è¡Œï¼Œæ‰‹æœºç«¯æ›´å‹å¥½ï¼‰ */
.wq-recent-title{
  margin-top: 8px;
  display:flex;
  align-items:flex-start;
  gap: 8px;
}
.wq-recent-title .docico{
  font-size: 16px;
  opacity: .95;
  margin-top: 1px;
}

/* æ ‡é¢˜é“¾æ¥ï¼šæ— ä¸‹åˆ’çº¿ï¼Œæ”¯æŒ 2 è¡Œçœç•¥ */
.wq-recent-title a{
  color: rgba(29,78,216,1);
  text-decoration: none !important;
  font-weight: 900;
  font-size: 18px;
  line-height: 1.28;

  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;   /* âœ… æ ‡é¢˜æœ€å¤šä¸¤è¡Œï¼Œæ‰‹æœºæ›´å¥½è¯» */
  overflow: hidden;
}
.wq-recent-item:hover .wq-recent-title a{
  color: rgba(29,78,216,1); /* hover ä¸å˜è‰²ï¼Œä¿æŒå…‹åˆ¶ */
}

/* å³ä¾§â€œæŸ¥çœ‹â€åšæˆæ–‡å­—é“¾æ¥ï¼ˆä¸åšå¤§æŒ‰é’®ï¼‰ */
.wq-recent-view{
  margin-left: auto;
  font-size: 12.5px;
  font-weight: 800;
  color: rgba(100,116,139,1);
  white-space: nowrap;
  text-decoration: none !important;
}
.wq-recent-view:hover{
  color: rgba(29,78,216,1);
  text-decoration: underline !important; /* åªç»™â€œæŸ¥çœ‹â€ä¸‹åˆ’çº¿ */
}

/* åº•éƒ¨â€œæŸ¥çœ‹å…¨éƒ¨æ–‡ç« â€æŒ‰é’®ï¼ˆä¿æŒä½ ç°æœ‰é£æ ¼ï¼‰ */
.wq-recent-more{
  margin-top: 10px;
  display:flex;
  justify-content:flex-end;
}
.wq-recent-more a{
  display:inline-flex;
  align-items:center;
  gap: 8px;
  padding: 9px 12px;
  border-radius: 999px;
  border: 1px solid rgba(0,0,0,.10);
  background: rgba(0,0,0,.04);
  color: rgba(15,23,42,.86);
  font-weight: 900;
  font-size: 13px;
  text-decoration:none !important;
}
.wq-recent-more a:hover{
  background: rgba(37,99,235,.08);
  border-color: rgba(37,99,235,.18);
  color: rgba(29,78,216,1);
}

/* Toastï¼šå¤åˆ¶æˆåŠŸæç¤º */
.wq-toast{
  position: fixed;
  left: 50%;
  bottom: 22px;
  transform: translateX(-50%) translateY(10px);
  opacity: 0;
  z-index: 99999;
  padding: 10px 14px;
  border-radius: 12px;
  border: 1px solid rgba(0,0,0,.10);
  background: rgba(255,255,255,.92);
  box-shadow: 0 10px 30px rgba(0,0,0,.12);
  font-size: 13px;
  font-weight: 900;
  color: rgba(15,23,42,.88);
  transition: opacity .18s ease, transform .18s ease;
}
.wq-toast.show{
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

/* ===== æš—é»‘æ¨¡å¼ ===== */
@media (prefers-color-scheme: dark){
  .wq-recent-item{
    background: rgba(24,24,27,.55);
    border-color: rgba(255,255,255,.10);
  }
  .wq-recent-item:hover{
    background: rgba(96,165,250,.08);
    border-color: rgba(96,165,250,.18);
  }

  .wq-recent-time{ color: rgba(209,213,219,.75); }

  .wq-recent-title a{ color: rgba(191,219,254,1); }
  .wq-recent-item:hover .wq-recent-title a{ color: rgba(191,219,254,1); }

  .wq-recent-view{ color: rgba(209,213,219,.70); }
  .wq-recent-view:hover{ color: rgba(191,219,254,1); }

  .wq-recent-copy{
    border-color: rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color: rgba(255,255,255,.86);
  }
  .wq-recent-copy:hover{ background: rgba(255,255,255,.10); }

  .wq-recent-more a{
    border-color: rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color: rgba(255,255,255,.86);
  }
  .wq-recent-more a:hover{
    background: rgba(96,165,250,.12);
    border-color: rgba(96,165,250,.18);
    color: rgba(191,219,254,1);
  }

  .wq-toast{
    background: rgba(24,24,27,.92);
    border-color: rgba(255,255,255,.14);
    color: rgba(255,255,255,.90);
  }
}

/* æ‰‹æœºæ›´ç´§å‡‘ï¼ˆä½†ä¸æŒ¤å‹æ ‡é¢˜ï¼‰ */
@media (max-width: 520px){
  .wq-recent-item{ padding: 10px 12px; }
  .wq-recent-title a{ font-size: 16.5px; }
}
</style>

<div class="wq-recent" id="wqRecentDocs">
  <div class="wq-recent-list">
    {{- range first $limit $docs -}}
      {{- $d := (cond (gt (.Lastmod.Unix) 0) (.Lastmod.Format "2006-01-02") (.Date.Format "2006-01-02")) -}}
      <div class="wq-recent-item" data-url="{{ .RelPermalink }}">
        <div class="wq-recent-top">
          <div class="wq-recent-time">
            <span class="ico" aria-hidden="true">ğŸ•’</span>
            <span>æ›´æ–°äº</span>
            <span>{{ $d }}</span>
          </div>

          <button class="wq-recent-copy" type="button" data-url="{{ .RelPermalink }}" aria-label="å¤åˆ¶æ–‡ç« é“¾æ¥">
            <span class="ico" aria-hidden="true">â§‰</span>
            <span>åˆ†äº«</span>
          </button>
        </div>

        <div class="wq-recent-title">
          <span class="docico" aria-hidden="true">ğŸ“„</span>
          <a href="{{ .RelPermalink }}">{{ .Title }}</a>
          <a class="wq-recent-view" href="{{ .RelPermalink }}">æŸ¥çœ‹ â†’</a>
        </div>
      </div>
    {{- end -}}
  </div>

  <div class="wq-recent-more">
    <a href="/docs/">æŸ¥çœ‹å…¨éƒ¨æ–‡ç«  â†’</a>
  </div>
</div>

<script>
(function(){
  const root = document.getElementById("wqRecentDocs");
  if(!root) return;

  function toast(msg){
    const el = document.createElement("div");
    el.className = "wq-toast";
    el.textContent = msg;
    document.body.appendChild(el);
    requestAnimationFrame(()=>el.classList.add("show"));
    setTimeout(()=>{
      el.classList.remove("show");
      setTimeout(()=>el.remove(), 220);
    }, 2600); // âœ… æç¤ºæ›´ä¹…
  }

  function copyText(text){
    if (navigator.clipboard && navigator.clipboard.writeText){
      return navigator.clipboard.writeText(text);
    }
    return new Promise((resolve) => {
      const ta = document.createElement("textarea");
      ta.value = text;
      ta.style.position = "fixed";
      ta.style.left = "-9999px";
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      ta.remove();
      resolve();
    });
  }

  // âœ… å¡ç‰‡ç‚¹å‡»ï¼šè¿›æ–‡ç« ï¼ˆä½†ç‚¹â€œåˆ†äº«/æŸ¥çœ‹â€ä¸è§¦å‘ï¼‰
  root.querySelectorAll(".wq-recent-item").forEach(card=>{
    card.addEventListener("click",(e)=>{
      const t = e.target;
      if (t.closest && t.closest(".wq-recent-copy")) return;
      if (t.closest && t.closest(".wq-recent-view")) return;
      if (t.tagName === "A") return; // æ ‡é¢˜é“¾æ¥
      const u = card.getAttribute("data-url");
      if (u) window.location.href = u;
    });
  });

  // âœ… åˆ†äº«å¤åˆ¶ï¼šä¸è·³è½¬
  root.querySelectorAll(".wq-recent-copy").forEach(btn=>{
    btn.addEventListener("click", async (e)=>{
      e.preventDefault();
      e.stopPropagation();
      let u = btn.getAttribute("data-url") || "";
      try { u = new URL(u, window.location.origin).toString(); } catch(_) {}
      await copyText(u);
      toast("é“¾æ¥å·²å¤åˆ¶ï¼Œå¯ç›´æ¥åˆ†äº« âœ¨");
    }, true);
  });
})();
</script>