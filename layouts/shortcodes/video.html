{{- $seed := "abcdefghijklmnopqrstuvwxyz0123456789" -}}
{{- $uid := substr (delimit (shuffle (split $seed "")) "") 0 8 -}}
<link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />

<style>
    /* 播放器容器：锁定 16:9，直角边框 */
    .video-container-yt {
        max-width: 100%;
        margin: 2rem auto;
        aspect-ratio: 16 / 9;
        background-color: #000;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        transition: box-shadow 0.3s ease;
    }

    /* ✅ 修复1：强制 Plyr 填满容器，防止加载时高度塌陷导致控件乱跑 */
    .video-container-yt .plyr {
        width: 100%;
        height: 100%;
    }

    /* --- Plyr 主题定制开始 --- */

    /* 全局主色调改为蓝色 (进度条、音量条、大播放按钮) */
    :root {
        --plyr-color-main: #007aff; /* 你可以修改这个十六进制代码来调整蓝色深浅 */
    }

    /* 底部控制栏背景：模仿 YouTube 的深色半透明渐变通栏 */
    .plyr--video .plyr__controls {
        position: absolute; /* ✅ 修复：绝对定位到底部 */
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0) 100%) !important;
        padding: 45px 10px 10px 10px; /* 增加顶部 padding 让渐变更自然 */
        z-index: 3;
    }

    /* 调整按钮和文字颜色为纯白 */
    .plyr__control, .plyr__time {
        color: #fff !important;
    }
    /* 鼠标悬停在按钮上的背景色，改为微弱的白色透明 */
    .plyr__control:hover {
        background: rgba(255, 255, 255, 0.1) !important;
    }

    /* 优化进度条轨道背景，使其更像截图中的深灰色 */
    .plyr__progress__container .plyr__progress__background {
        background-color: rgba(255, 255, 255, 0.25) !important;
    }

    /* ✅ 优化：加载动画更明显、更专业 */
    .plyr__spinner {
        width: 48px;
        height: 48px;
        border-width: 4px;
        border-color: rgba(255, 255, 255, 0.15);
        border-top-color: var(--plyr-color-main);
    }

    /* 底部细长进度条（鼠标移出时显示） */
    .wq-video-bottom-line {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: rgba(255,255,255,0.1);
        z-index: 2; /* 位于视频之上，但低于控制栏(z-index:3) */
        pointer-events: none;
        transition: opacity 0.3s ease;
    }
    .wq-video-progress-fill {
        height: 100%;
        background-color: var(--plyr-color-main);
        width: 0%;
        transition: width 0.2s linear;
    }
    /* 鼠标悬停时，显示主控制栏，隐藏底部细条（避免视觉重复） */
    .video-container-yt:hover .wq-video-bottom-line {
        opacity: 0;
    }
    /* --- Plyr 主题定制结束 --- */
</style>


<div class="video-container-yt" id="vc-{{ $uid }}">
    <video class="js-player" id="vp-{{ $uid }}" playsinline controls preload="metadata" data-poster="{{ .Get "poster" }}">
        <source src="{{ .Get "src" }}" type="video/mp4" />
    </video>
    <!-- 新增：底部进度条 -->
    <div class="wq-video-bottom-line">
        <div class="wq-video-progress-fill"></div>
    </div>
</div>


<script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
<script>
    // 等待 DOM 加载完成
    document.addEventListener('DOMContentLoaded', () => {
        // 使用唯一 ID 初始化，避免多个视频冲突
        const player = new Plyr('#vp-{{ $uid }}', {
            controls: [
                'play-large',   // 视频中心的大播放按钮
                'play',         // 底部左侧的小播放/暂停按钮
                'progress',     // 进度条
                'current-time', // 当前播放时间
                'duration',     // 总时长
                'mute',         // 音量喇叭图标
                'volume',       // 音量调节滑块
                'fullscreen'    // 全屏按钮
            ],
            // 其他配置
            seekTime: 10, // 左右方向键快进/快退秒数
            i18n: { // 简单的汉化提示
                play: '播放',
                pause: '暂停',
                mute: '静音',
                unmute: '取消静音',
                enableCaptions: '启用字幕',
                disableCaptions: '关闭字幕',
                enterFullscreen: '进入全屏',
                exitFullscreen: '退出全屏',
            }
        });

        // 监听进度更新，同步底部细条
        player.on('timeupdate', event => {
            const container = document.getElementById('vc-{{ $uid }}');
            const fill = container.querySelector('.wq-video-progress-fill');
            if (fill && player.duration > 0) {
                const percentage = (player.currentTime / player.duration) * 100;
                fill.style.width = `${percentage}%`;
            }
        });
    });
</script>