{{/* =========================================================
   all-docs.html  (FINAL)
   GitHub-like list card: 时间(左上) + 分享(右上) + 标题(蓝) + 副标题(灰) + 标签(左下) + 阅读(右下)
   - 支持分页
   - 支持复制链接并 Toast
   - 标签仅在列表显示
   ========================================================= */}}

{{- $perPage := 7 -}} {{/* 每页显示数量：想改就改这里 */}}

{{- $all := (where .Site.RegularPages "Section" "docs") -}}
{{- $all = (where $all "Kind" "page") -}}
{{- $all = ($all.ByLastmod.Reverse) -}}

{{- $p := (.Page.Paginate $all $perPage) -}}

<style>
  /* ===== Container ===== */
  .wq-doclist{ margin-top: 14px; }
  .wq-doc-card{
    display:block;
    position:relative;
    padding: 14px 16px 12px;
    margin: 12px 0;
    border-radius: 16px;
    border: 1px solid rgba(0,0,0,.06);
    background: rgba(255,255,255,.75);
    text-decoration: none !important;
    transition: background-color .16s ease, border-color .16s ease;
  }
  .wq-doc-card:hover{
    background: rgba(37,99,235,.045);
    border-color: rgba(37,99,235,.16);
  }

  html.dark .wq-doc-card{
    background: rgba(24,24,27,.52);
    border-color: rgba(255,255,255,.10);
  }
  html.dark .wq-doc-card:hover{
    background: rgba(255,255,255,.04);
    border-color: rgba(255,255,255,.14);
  }

  /* ===== Top row: time + share ===== */
  .wq-doc-top{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 12px;
    margin-bottom: 8px;
  }
  .wq-doc-time{
    display:flex;
    align-items:center;
    gap: 8px;
    font-size: 12.5px;
    color: rgba(100,116,139,.92);
    font-variant-numeric: tabular-nums;
    white-space: nowrap;
  }
  .wq-doc-dot{
    width: 8px;
    height: 8px;
    border-radius: 999px;
    background: rgba(37,99,235,.50);
    box-shadow: 0 0 0 4px rgba(37,99,235,.10);
    flex: 0 0 auto;
  }
  html.dark .wq-doc-time{ color: rgba(209,213,219,.72); }
  html.dark .wq-doc-dot{
    background: rgba(96,165,250,.65);
    box-shadow: 0 0 0 4px rgba(96,165,250,.14);
  }

  .wq-doc-share{
    display:inline-flex;
    align-items:center;
    gap: 6px;
    font-size: 12.5px;
    font-weight: 650;
    color: rgba(100,116,139,.92);
    text-decoration:none !important;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid rgba(0,0,0,.06);
    background: rgba(0,0,0,.02);
    cursor:pointer;
    user-select:none;
    white-space: nowrap;
  }
  .wq-doc-share:hover{
    background: rgba(37,99,235,.06);
    border-color: rgba(37,99,235,.14);
    color: rgba(29,78,216,1);
  }
  html.dark .wq-doc-share{
    color: rgba(209,213,219,.72);
    border-color: rgba(255,255,255,.10);
    background: rgba(255,255,255,.04);
  }
  html.dark .wq-doc-share:hover{
    background: rgba(255,255,255,.06);
    border-color: rgba(255,255,255,.14);
    color: rgba(191,219,254,1);
  }

  /* ===== Title + subtitle ===== */
  .wq-doc-title{
    font-size: 16.5px;
    font-weight: 850;
    line-height: 1.25;
    color: #2563eb;
    margin: 2px 0 6px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  html.dark .wq-doc-title{ color: rgba(147,197,253,1); }

  .wq-doc-sub{
    font-size: 13px;
    line-height: 1.55;
    color: rgba(100,116,139,.95);
    margin: 0 0 10px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  html.dark .wq-doc-sub{ color: rgba(209,213,219,.70); }

  /* ===== Bottom row: tags + read ===== */
  .wq-doc-bottom{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 12px;
  }

  .wq-doc-tags{
    display:flex;
    flex-wrap: wrap;
    gap: 8px;
    min-width: 0;
  }
  .wq-doc-tag{
    font-size: 12px;
    color: rgba(100,116,139,.95);
    background: rgba(148,163,184,.16);
    padding: 4px 10px;
    border-radius: 999px;
    white-space: nowrap;
  }
  html.dark .wq-doc-tag{
    color: rgba(209,213,219,.78);
    background: rgba(255,255,255,.07);
  }

  .wq-doc-read{
    font-size: 12.5px;
    font-weight: 750;
    color: rgba(100,116,139,.92);
    white-space: nowrap;
  }
  .wq-doc-card:hover .wq-doc-read{
    color: rgba(29,78,216,1);
  }
  html.dark .wq-doc-read{ color: rgba(209,213,219,.70); }
  html.dark .wq-doc-card:hover .wq-doc-read{ color: rgba(191,219,254,1); }

  /* ===== Toast ===== */
  .wq-toast{
    position: fixed;
    left: 50%;
    bottom: 18px;
    transform: translateX(-50%);
    z-index: 99999;
    background: rgba(17,24,39,.92);
    color: rgba(255,255,255,.94);
    padding: 10px 12px;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 650;
    box-shadow: 0 18px 50px rgba(0,0,0,.22);
    opacity: 0;
    pointer-events: none;
    transition: opacity .18s ease, transform .18s ease;
  }
  .wq-toast.show{
    opacity: 1;
    transform: translateX(-50%) translateY(-2px);
  }

  /* ===== Pagination (GitHub-like, minimal) ===== */
  .wq-pager{
    display:flex;
    justify-content:flex-end;
    align-items:center;
    gap: 10px;
    margin-top: 18px;
    user-select:none;
  }
  .wq-pager a{
    color: rgba(100,116,139,.92);
    text-decoration:none !important;
    font-size: 13px;
    font-weight: 650;
    padding: 6px 8px;
    border-radius: 10px;
    transition: background .14s ease, color .14s ease;
  }
  .wq-pager a:hover{
    background: rgba(37,99,235,.08);
    color: rgba(29,78,216,1);
  }
  .wq-pager .cur{
    background: rgba(37,99,235,.10);
    color: rgba(29,78,216,1);
  }
  html.dark .wq-pager a{
    color: rgba(209,213,219,.70);
  }
  html.dark .wq-pager a:hover{
    background: rgba(255,255,255,.06);
    color: rgba(191,219,254,1);
  }
  html.dark .wq-pager .cur{
    background: rgba(147,197,253,.12);
    color: rgba(191,219,254,1);
  }

  /* 手机端保证分页显示 */
  @media (max-width: 520px){
    .wq-doc-share{ padding: 6px 8px; }
    .wq-pager{ justify-content:center; }
  }
</style>

<div class="wq-doclist">
  {{- range $p.Pages -}}
    {{- $url := .Permalink -}}
    {{- $last := .Lastmod.Format "2006-01-02" -}}

    {{/* 副标题：优先手写 description；没有就用自动摘要 */}}
    {{- $desc := "" -}}
    {{- with .Params.description -}}
      {{- $desc = . -}}
    {{- else -}}
      {{- $desc = (.Summary | plainify) -}}
    {{- end -}}

    {{/* 标签：只列表展示，取 tags（或 tag），最多 4 个 */}}
    {{- $tags := slice -}}
    {{- with .Params.tags -}}{{- $tags = . -}}{{- end -}}
    {{- if and (eq (len $tags) 0) (.Params.tag) -}}
      {{- $tags = (slice .Params.tag) -}}
    {{- end -}}

    <a class="wq-doc-card" href="{{ .RelPermalink }}">
      <div class="wq-doc-top">
        <div class="wq-doc-time">
          <span class="wq-doc-dot" aria-hidden="true"></span>
          <span>最后更新</span>
          <span>{{ $last }}</span>
        </div>

        <span
          class="wq-doc-share"
          role="button"
          tabindex="0"
          data-copy="{{ $url }}"
          onclick="wqCopyLink(this)"
          onkeydown="if(event.key==='Enter'){wqCopyLink(this)}"
        >分享 ↗</span>
      </div>

      <div class="wq-doc-title">{{ .Title }}</div>

      {{- if $desc -}}
        <div class="wq-doc-sub">{{ $desc }}</div>
      {{- end -}}

      <div class="wq-doc-bottom">
        <div class="wq-doc-tags">
          {{- range first 4 $tags -}}
            <span class="wq-doc-tag">{{ . }}</span>
          {{- end -}}
        </div>

        <div class="wq-doc-read">阅读 →</div>
      </div>
    </a>
  {{- end -}}
</div>

{{/* ===== Pagination (only when >1 page) ===== */}}
{{- if gt $p.TotalPages 1 -}}
  <nav class="wq-pager" aria-label="pagination">
    {{- with $p.Prev -}}
      <a href="{{ .URL }}">Previous</a>
    {{- end -}}

    {{- range $p.Pagers -}}
      {{- if eq .PageNumber $p.PageNumber -}}
        <a class="cur" href="{{ .URL }}">{{ .PageNumber }}</a>
      {{- else -}}
        <a href="{{ .URL }}">{{ .PageNumber }}</a>
      {{- end -}}
    {{- end -}}

    {{- with $p.Next -}}
      <a href="{{ .URL }}">Next</a>
    {{- end -}}
  </nav>
{{- end -}}

<div class="wq-toast" id="wqToast">文章链接已复制，可直接分享</div>

<script>
  function wqCopyLink(el){
    try{
      var url = el.getAttribute("data-copy") || "";
      if(!url) return;

      function toast(){
        var t = document.getElementById("wqToast");
        if(!t) return;
        t.classList.add("show");
        window.setTimeout(function(){ t.classList.remove("show"); }, 1400);
      }

      if (navigator.clipboard && navigator.clipboard.writeText){
        navigator.clipboard.writeText(url).then(toast).catch(function(){
          // fallback
          var ta = document.createElement("textarea");
          ta.value = url;
          ta.style.position = "fixed";
          ta.style.left = "-9999px";
          document.body.appendChild(ta);
          ta.select();
          document.execCommand("copy");
          document.body.removeChild(ta);
          toast();
        });
      }else{
        var ta = document.createElement("textarea");
        ta.value = url;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        toast();
      }
    }catch(e){}
  }
</script>