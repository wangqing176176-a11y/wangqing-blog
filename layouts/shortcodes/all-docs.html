{{- /* =========================================================
   âœ… all-docs.htmlï¼ˆä¼˜åŒ–å¢å¼ºç‰ˆï¼‰
   è·¯å¾„ï¼šlayouts/shortcodes/all-docs.html
   ä½œç”¨ï¼šä¿®å¤Hoveræ¸éšè‰²å—ã€è‡ªå®šä¹‰æ¸éšä½ç½®ã€è°ƒæ•´é—´è·
   ========================================================= */ -}}

{{- $perPage := 10 -}}
{{- with .Get "perpage" -}}
  {{- $perPage = (int .) -}}
{{- end -}}

{{- $docs := where site.RegularPages "Section" "docs" -}}
{{- $docs = $docs.ByDate.Reverse -}}

<style>
/* =========================================================
   0) åŸºç¡€ç»“æ„
   ========================================================= */
#wqAllDocs{ margin-top: 14px; }
#wqAllDocs .wq-doc-list{ margin-top: 12px; padding:0; list-style:none; }

/* =========================================================
   1) å¡ç‰‡å˜é‡ä¸æ ·å¼
   ========================================================= */
#wqAllDocs a.wq-doc-item {
  position: relative;
  display:block;
  border: 1px solid rgba(0,0,0,.08);
  border-radius: 12px;
  padding: 12px 14px; /* ç•¥å¾®å¢åŠ å†…è¾¹è· */
  margin: 10px 0;

  /* âœ… å®šä¹‰é¢œè‰²å˜é‡ï¼Œæ–¹ä¾¿ä¼ªå…ƒç´ è°ƒç”¨ */
  --wq-card-bg: rgba(255,255,255,.70);
  --wq-card-bg-hover: rgba(37,99,235,.03);

  background: var(--wq-card-bg);
  box-shadow: 0 8px 18px rgba(15,23,42,.05);
  transition: all .2s ease;
  cursor: pointer;
  text-decoration: none !important;
  color: inherit;
}

#wqAllDocs a.wq-doc-item:hover {
  background: var(--wq-card-bg-hover);
  border-color: rgba(37,99,235,.14);
  box-shadow: 0 10px 22px rgba(15,23,42,.08);
}

/* =========================================================
   2) é¡¶éƒ¨ï¼šæ—¶é—´ä¸åˆ†äº«
   ========================================================= */
#wqAllDocs .wq-doc-top{ display:flex; align-items:center; justify-content:space-between; gap: 12px; }
#wqAllDocs .wq-doc-time{
  display:flex; align-items:center; gap: 8px;
  color: rgba(100,116,139,1); font-size: 12.5px;
}
#wqAllDocs .wq-copy{
  display:inline-flex; align-items:center; gap: 6px; padding: 3px 8px;
  border-radius: 10px; border: 1px solid rgba(0,0,0,.10);
  background: rgba(255,255,255,.60); color: rgba(15,23,42,.72);
  font-size: 12px; font-weight: 800; cursor: pointer; transition: all .15s;
}
#wqAllDocs .wq-copy:hover{ background: rgba(255,255,255,.86); border-color: rgba(0,0,0,.12); }

/* =========================================================
   3) æ ‡é¢˜ï¼šå¢åŠ ä¸ä¸‹æ–¹çš„é—´è·
   ========================================================= */
#wqAllDocs .wq-doc-title{
  margin-top: 10px;
  font-weight: 900;
  font-size: 19px;
  color: rgba(29,78,216,1);
  line-height: 1.25;
  display:flex;
  align-items:center;
  gap: 8px;
}

/* =========================================================
   4) æ‘˜è¦ï¼šæ§åˆ¶è‚‰çœ¼æ˜¾ç¤ºåŠè¡Œ + ä¿®å¤è‰²å—
   ========================================================= */
#wqAllDocs .wq-doc-desc {
  /* âœ… è°ƒæ•´ä¸æ ‡é¢˜çš„é—´è·ï¼šä»6pxå¢è‡³10px */
  margin-top: 10px; 
  color: rgba(100,116,139,1);
  font-size: 15px;
  line-height: 1.55;
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2; /* ä¾ç„¶é™åˆ¶ä¸¤è¡Œ */
  overflow: hidden;
  position: relative;
}

/* âœ… æ¸éšå±‚é®ç½© */
#wqAllDocs .wq-doc-desc::after {
  content: "";
  position: absolute;
  left: 0; right: 0; bottom: 0;
  height: 1.55em; /* å¯¹åº” line-heightï¼Œåªé®ç›–ç¬¬äºŒè¡Œ */
  pointer-events: none;
  
  /* âœ… æ¸éšé€»è¾‘è°ƒæ•´ï¼š
     - ä» 40% ä½ç½®å¼€å§‹å‡ºç°é®ç½©ï¼ˆè®©ç¬¬äºŒè¡Œçœ‹èµ·æ¥åªæœ‰åŠè¡Œï¼‰
     - é¢œè‰²ç»ˆç‚¹ä½¿ç”¨å½“å‰å¡ç‰‡çš„èƒŒæ™¯å˜é‡
  */
  background: linear-gradient(
    to right,
    rgba(255, 255, 255, 0) 0%,
    rgba(255, 255, 255, 0) 40%, 
    var(--wq-card-bg) 90%,
    var(--wq-card-bg) 100%
  );
  transition: background .2s ease;
}

/* âœ… å½“å¡ç‰‡ Hover æ—¶ï¼ŒåŒæ­¥æ›´æ–°æ¸éšå±‚çš„èƒŒæ™¯è‰²å˜é‡ï¼Œé˜²æ­¢å‡ºç°è‰²å— */
#wqAllDocs a.wq-doc-item:hover .wq-doc-desc::after {
  background: linear-gradient(
    to right,
    rgba(255, 255, 255, 0) 0%,
    rgba(255, 255, 255, 0) 40%,
    var(--wq-card-bg-hover) 90%,
    var(--wq-card-bg-hover) 100%
  );
}

/* =========================================================
   5) åº•éƒ¨æ ‡ç­¾ä¸æŸ¥çœ‹
   ========================================================= */
#wqAllDocs .wq-doc-bottom{ display:flex; align-items:flex-end; justify-content:space-between; margin-top: 12px; }
#wqAllDocs .wq-tag{
  padding: 3px 8px; border-radius: 999px; font-size: 11.5px; font-weight: 700;
  background: rgba(148,163,184,.12); border: 1px solid rgba(148,163,184,.22); color: rgba(107,114,128,1);
}
#wqAllDocs .wq-view{ font-size: 12.5px; font-weight: 800; color: rgba(100,116,139,1); }

/* =========================================================
   6) æš—é»‘æ¨¡å¼é€‚é…
   ========================================================= */
html.dark #wqAllDocs a.wq-doc-item {
  --wq-card-bg: rgba(24,24,27,.55);
  --wq-card-bg-hover: rgba(96,165,250,.08);
  background: var(--wq-card-bg);
  border-color: rgba(255,255,255,.10);
  box-shadow: 0 16px 40px rgba(0,0,0,.35);
}
html.dark #wqAllDocs a.wq-doc-item:hover {
  border-color: rgba(96,165,250,.18);
}
html.dark #wqAllDocs .wq-doc-title { color: rgba(191,219,254,1); }
html.dark #wqAllDocs .wq-doc-desc { color: rgba(209,213,219,.78); }
html.dark #wqAllDocs .wq-copy {
  border-color: rgba(255,255,255,.14); background: rgba(255,255,255,.06); color: rgba(255,255,255,.86);
}

/* =========================================================
   7) å…¶ä»–ï¼ˆåˆ†é¡µã€Toastã€æ‰‹æœºç«¯ï¼‰
   ========================================================= */
#wqAllDocs .wq-pager{ position: sticky; bottom: 12px; display:flex; justify-content:flex-end; gap:10px; margin-top: 12px; }
#wqAllDocs .wq-pagebtn{ padding: 4px 10px; border-radius: 10px; font-weight: 800; font-size: 12.5px; color: rgba(107,114,128,1); cursor: pointer; transition: all .15s; }
#wqAllDocs .wq-pagebtn.is-active{ color: rgba(29,78,216,1); background: rgba(37,99,235,.12); }
#wqAllDocs .wq-pagebtn.is-disabled{ opacity:.4; pointer-events:none; }
.wq-toast{ position: fixed; left: 50%; bottom: 22px; transform: translateX(-50%) translateY(10px); opacity: 0; z-index: 9999; padding: 10px 14px; border-radius: 12px; background: rgba(255,255,255,.92); box-shadow: 0 10px 30px rgba(0,0,0,.12); font-size: 13px; font-weight: 900; transition: all .2s; }
.wq-toast.show{ opacity: 1; transform: translateX(-50%) translateY(0); }
html.dark .wq-toast{ background: rgba(24,24,27,.92); color: #fff; border: 1px solid rgba(255,255,255,.1); }

@media (max-width: 520px){
  #wqAllDocs .wq-doc-title{ font-size: 16.5px; }
  #wqAllDocs .wq-doc-desc{ font-size: 14px; }
}
</style>

<div id="wqAllDocs" data-perpage="{{ $perPage }}">
  <div id="wqAllDocsList"></div>
  <nav class="wq-pager" id="wqAllDocsPager"></nav>

  <template id="wqAllDocsData">
    {{- range $docs -}}
      {{- $desc := "" -}}
      {{- with .Params.description -}}
        {{- $desc = . | plainify -}}
      {{- else -}}
        {{- if gt (len .Summary) 0 -}}
          {{- $desc = .Summary | plainify -}}
        {{- else -}}
          {{- $desc = .Plain -}}
        {{- end -}}
      {{- end -}}
      <div
        data-last="{{ (cond (gt (.Lastmod.Unix) 0) (.Lastmod.Format "2006-01-02") (.Date.Format "2006-01-02")) }}"
        data-title="{{ .Title | htmlEscape }}"
        data-url="{{ .RelPermalink }}"
        data-tags="{{ delimit (default (slice) .Params.tags) "|" | htmlEscape }}"
        data-desc="{{ $desc | htmlEscape }}">
      </div>
    {{- end -}}
  </template>
</div>

<script>
(function(){
  const root = document.getElementById("wqAllDocs");
  if(!root) return;

  const perPage = parseInt(root.dataset.perpage || "10", 10);
  const listEl = document.getElementById("wqAllDocsList");
  const pagerEl = document.getElementById("wqAllDocsPager");
  const dataTpl = document.getElementById("wqAllDocsData");
  const rows = Array.from(dataTpl.content.children);

  let current = 1;
  const totalPages = Math.ceil(rows.length / perPage);

  function toast(msg){
    const el = document.createElement("div");
    el.className = "wq-toast";
    el.textContent = msg;
    document.body.appendChild(el);
    setTimeout(()=>el.classList.add("show"), 10);
    setTimeout(()=>{
      el.classList.remove("show");
      setTimeout(()=>el.remove(), 200);
    }, 2500);
  }

  async function copyText(text){
    try {
      await navigator.clipboard.writeText(text);
    } catch(e) {
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      ta.remove();
    }
  }

  function renderList(page){
    const slice = rows.slice((page-1)*perPage, page*perPage);
    listEl.innerHTML = `<div class="wq-doc-list">` + slice.map(r => {
      const tags = (r.dataset.tags || "").split("|").filter(Boolean).slice(0,5);
      return `
        <a class="wq-doc-item" href="${r.dataset.url}">
          <div class="wq-doc-top">
            <div class="wq-doc-time">ğŸ•’ æ›´æ–°äº ${r.dataset.last}</div>
            <button class="wq-copy" data-url="${r.dataset.url}">â§‰ åˆ†äº«</button>
          </div>
          <div class="wq-doc-title">ğŸ“„ ${r.dataset.title}</div>
          <div class="wq-doc-desc">${r.dataset.desc}</div>
          <div class="wq-doc-bottom">
            <div class="wq-tags">${tags.map(t=>`<span class="wq-tag">${t}</span>`).join("")}</div>
            <span class="wq-view">æŸ¥çœ‹æ–‡ç«  â†’</span>
          </div>
        </a>`;
    }).join("") + `</div>`;

    listEl.querySelectorAll(".wq-copy").forEach(btn=>{
      btn.addEventListener("click", async (e)=>{
        e.preventDefault(); e.stopPropagation();
        const fullUrl = new URL(btn.dataset.url, window.location.origin).href;
        await copyText(fullUrl);
        toast("åˆ†äº«é“¾æ¥å¤åˆ¶æˆåŠŸâœ¨");
      });
    });
  }

  function renderPager(page){
    if(totalPages <= 1) return;
    let html = `<span class="wq-pagebtn ${page===1?'is-disabled':''}" data-p="${page-1}">ä¸Šä¸€é¡µ</span>`;
    for(let i=1;i<=totalPages;i++){
      html += `<span class="wq-pagebtn ${i===page?'is-active':''}" data-p="${i}">${i}</span>`;
    }
    html += `<span class="wq-pagebtn ${page===totalPages?'is-disabled':''}" data-p="${page+1}">ä¸‹ä¸€é¡µ</span>`;
    pagerEl.innerHTML = html;
    pagerEl.querySelectorAll(".wq-pagebtn:not(.is-disabled)").forEach(b=>{
      b.onclick = ()=>{
        current = parseInt(b.dataset.p);
        renderList(current); renderPager(current);
        window.scrollTo({top: root.offsetTop - 70, behavior: 'smooth'});
      };
    });
  }

  renderList(1); renderPager(1);
})();
</script>