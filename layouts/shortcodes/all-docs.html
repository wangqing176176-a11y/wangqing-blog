{{/* =========================================================
   all-docs.html（卡片式文档列表 + 标签 + 复制链接 + 分页）
   使用方式：在 content/docs/_index.md 里写  {{< all-docs >}}
   ========================================================= */}}

{{- $perPage := 8 -}} {{/* ✅ 每页显示几篇：改这里 */}}

{{- $page := .Page -}}
{{- $all := where site.RegularPages "Section" "docs" -}}
{{- $all = where $all "Kind" "page" -}}
{{- $all = $all.ByLastmod.Reverse -}}

{{- $p := $page.Paginate $all $perPage -}}

<div class="wq-doc2-wrap">
  <div class="wq-doc2-list">
    {{- range $p.Pages -}}
      {{- $last := (cond (gt (.Lastmod.Unix) 0) (.Lastmod.Format "2006-01-02") (.Date.Format "2006-01-02")) -}}
      {{- $subtitle := "" -}}
      {{- with .Params.description -}}
        {{- $subtitle = . -}}
      {{- else -}}
        {{- /* 兜底：用 Summary（去掉过长） */ -}}
        {{- $subtitle = (.Summary | plainify) -}}
      {{- end -}}

      <article class="wq-doc2-card">
        <!-- 左上：最后更新 -->
        <div class="wq-doc2-top">
          <span class="wq-doc2-dot" aria-hidden="true"></span>
          <span class="wq-doc2-time">最后更新 {{ $last }}</span>

          <!-- 右上：复制链接 -->
          <button class="wq-doc2-copy" type="button" data-url="{{ .Permalink }}" aria-label="复制文章链接" title="复制链接">
            ⧉
          </button>
        </div>

        <!-- 标题 + 副标题 -->
        <a class="wq-doc2-main" href="{{ .RelPermalink }}">
          <div class="wq-doc2-title">{{ .Title }}</div>
          {{- if $subtitle -}}
            <div class="wq-doc2-sub">{{ $subtitle }}</div>
          {{- end -}}
        </a>

        <!-- 左下：标签 / 右下：查看 -->
        <div class="wq-doc2-bottom">
          <div class="wq-doc2-tags">
            {{- with .Params.tags -}}
              {{- range first 3 . -}}
                <span class="wq-doc2-tag">{{ . }}</span>
              {{- end -}}
            {{- end -}}
          </div>

          <a class="wq-doc2-read" href="{{ .RelPermalink }}">查看 →</a>
        </div>
      </article>
    {{- end -}}
  </div>

  {{/* 分页（只在 >1 页时显示） */}}
  {{- if gt $p.TotalPages 1 -}}
    <nav class="wq-doc2-pager" aria-label="分页">
      {{- if $p.HasPrev -}}
        <a class="wq-doc2-pbtn" href="{{ $p.Prev.URL }}">上一页</a>
      {{- else -}}
        <span class="wq-doc2-pbtn is-disabled">上一页</span>
      {{- end -}}

      {{/* 页码：最多显示 5 个（当前居中） */}}
      {{- $cur := $p.PageNumber -}}
      {{- $total := $p.TotalPages -}}
      {{- $start := sub $cur 2 -}}
      {{- if lt $start 1 }}{{- $start = 1 -}}{{- end -}}
      {{- $end := add $start 4 -}}
      {{- if gt $end $total -}}
        {{- $end = $total -}}
        {{- $start = sub $end 4 -}}
        {{- if lt $start 1 }}{{- $start = 1 -}}{{- end -}}
      {{- end -}}

      {{- range $i := seq $start $end -}}
        {{- $u := (index $p.Pagers (sub $i 1)).URL -}}
        {{- if eq $i $cur -}}
          <span class="wq-doc2-pnum is-active">{{ $i }}</span>
        {{- else -}}
          <a class="wq-doc2-pnum" href="{{ $u }}">{{ $i }}</a>
        {{- end -}}
      {{- end -}}

      {{- if $p.HasNext -}}
        <a class="wq-doc2-pbtn" href="{{ $p.Next.URL }}">下一页</a>
      {{- else -}}
        <span class="wq-doc2-pbtn is-disabled">下一页</span>
      {{- end -}}
    </nav>
  {{- end -}}

  <div class="wq-doc2-toast" id="wqDocToast" role="status" aria-live="polite"></div>
</div>

<style>
/* ========= Docs List v2 (GitHub-like, fits blue clean style) ========= */
.wq-doc2-wrap{ margin-top: 14px; }
.wq-doc2-list{ display: grid; gap: 12px; }
.wq-doc2-card{
  border: 1px solid rgba(0,0,0,.06);
  border-radius: 18px;
  background: rgba(255,255,255,.75);
  padding: 14px 14px 12px;
  transition: background-color .18s ease, border-color .18s ease;
}
.wq-doc2-card:hover{
  background: rgba(37,99,235,.05);
  border-color: rgba(37,99,235,.18);
}

.wq-doc2-top{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  margin-bottom: 8px;
}
.wq-doc2-dot{
  width: 9px; height: 9px;
  border-radius: 999px;
  background: rgba(37,99,235,.55);
  box-shadow: 0 0 0 4px rgba(37,99,235,.10);
  flex: 0 0 auto;
}
.wq-doc2-time{
  font-size: 12px;
  color: rgba(100,116,139,1);
  font-variant-numeric: tabular-nums;
  margin-right:auto;
}
.wq-doc2-copy{
  border: 1px solid rgba(0,0,0,.10);
  background: rgba(0,0,0,.03);
  color: rgba(15,23,42,.72);
  border-radius: 12px;
  padding: 6px 10px;
  cursor: pointer;
  font-weight: 800;
}
.wq-doc2-copy:hover{ background: rgba(37,99,235,.08); border-color: rgba(37,99,235,.18); }

.wq-doc2-main{ text-decoration:none !important; display:block; }
.wq-doc2-title{
  color: #2563eb;
  font-weight: 900;
  font-size: 16px;
  line-height: 1.25;
  margin: 2px 0 6px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.wq-doc2-sub{
  color: rgba(100,116,139,1);
  font-size: 13px;
  line-height: 1.55;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.wq-doc2-bottom{
  display:flex;
  align-items:flex-end;
  justify-content:space-between;
  gap: 10px;
  margin-top: 10px;
}
.wq-doc2-tags{ display:flex; gap:6px; flex-wrap:wrap; min-height: 18px; }
.wq-doc2-tag{
  font-size: 12px;
  color: rgba(100,116,139,1);
  background: rgba(148,163,184,.16);
  border: 1px solid rgba(0,0,0,.06);
  border-radius: 999px;
  padding: 2px 8px;
}
.wq-doc2-read{
  text-decoration:none !important;
  font-weight: 800;
  color: rgba(15,23,42,.70);
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid rgba(0,0,0,.08);
  background: rgba(0,0,0,.02);
}
.wq-doc2-read:hover{
  background: rgba(37,99,235,.08);
  border-color: rgba(37,99,235,.18);
  color: rgba(29,78,216,1);
}

/* Pager: 右下角更简洁 */
.wq-doc2-pager{
  margin-top: 14px;
  display:flex;
  gap: 10px;
  align-items:center;
  justify-content:flex-end;
  flex-wrap: wrap;
}
.wq-doc2-pbtn, .wq-doc2-pnum{
  text-decoration:none !important;
  font-weight: 800;
  color: rgba(15,23,42,.70);
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid rgba(0,0,0,.08);
  background: rgba(0,0,0,.02);
}
.wq-doc2-pbtn.is-disabled{
  opacity:.45;
  cursor:not-allowed;
}
.wq-doc2-pnum.is-active{
  background: rgba(37,99,235,.12);
  border-color: rgba(37,99,235,.22);
  color: rgba(29,78,216,1);
}
.wq-doc2-pbtn:hover, .wq-doc2-pnum:hover{
  background: rgba(37,99,235,.08);
  border-color: rgba(37,99,235,.18);
  color: rgba(29,78,216,1);
}

/* Toast */
.wq-doc2-toast{
  position: fixed;
  left: 50%;
  bottom: 18px;
  transform: translateX(-50%);
  padding: 10px 14px;
  border-radius: 14px;
  border: 1px solid rgba(0,0,0,.10);
  background: rgba(255,255,255,.92);
  box-shadow: 0 14px 40px rgba(15,23,42,.14);
  color: rgba(15,23,42,.82);
  font-weight: 800;
  font-size: 13px;
  opacity: 0;
  pointer-events: none;
  transition: opacity .18s ease, transform .18s ease;
  z-index: 9999;
}
.wq-doc2-toast.show{
  opacity: 1;
  transform: translateX(-50%) translateY(-2px);
}

@media (prefers-color-scheme: dark){
  .wq-doc2-card{
    background: rgba(24,24,27,.55);
    border-color: rgba(255,255,255,.10);
  }
  .wq-doc2-card:hover{
    background: rgba(96,165,250,.10);
    border-color: rgba(96,165,250,.22);
  }
  .wq-doc2-time, .wq-doc2-sub{ color: rgba(209,213,219,.75); }
  .wq-doc2-dot{
    background: rgba(96,165,250,.70);
    box-shadow: 0 0 0 4px rgba(96,165,250,.16);
  }
  .wq-doc2-copy{
    border-color: rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    color: rgba(255,255,255,.85);
  }
  .wq-doc2-read, .wq-doc2-pbtn, .wq-doc2-pnum{
    border-color: rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    color: rgba(255,255,255,.80);
  }
  .wq-doc2-tag{
    color: rgba(209,213,219,.82);
    background: rgba(255,255,255,.06);
    border-color: rgba(255,255,255,.10);
  }
  .wq-doc2-toast{
    border-color: rgba(255,255,255,.12);
    background: rgba(24,24,27,.92);
    color: rgba(255,255,255,.88);
    box-shadow: 0 18px 60px rgba(0,0,0,.45);
  }
}

/* 手机：按钮别挤 */
@media (max-width: 520px){
  .wq-doc2-top{ flex-wrap: wrap; }
  .wq-doc2-copy{ margin-left:auto; }
  .wq-doc2-bottom{ align-items:flex-start; }
  .wq-doc2-pager{ justify-content:center; }
}
</style>

<script>
(function(){
  // 复制链接 + toast
  function toast(msg){
    var el = document.getElementById("wqDocToast");
    if(!el) return;
    el.textContent = msg || "已复制链接";
    el.classList.add("show");
    clearTimeout(el._t);
    el._t = setTimeout(function(){ el.classList.remove("show"); }, 1100);
  }

  function copyText(text){
    if(navigator.clipboard && window.isSecureContext){
      return navigator.clipboard.writeText(text);
    }
    var ta = document.createElement("textarea");
    ta.value = text;
    ta.style.position = "fixed";
    ta.style.left = "-9999px";
    document.body.appendChild(ta);
    ta.focus();
    ta.select();
    try { document.execCommand("copy"); } catch(e){}
    document.body.removeChild(ta);
    return Promise.resolve();
  }

  document.addEventListener("click", function(e){
    var btn = e.target && (e.target.closest ? e.target.closest(".wq-doc2-copy") : null);
    if(!btn) return;
    e.preventDefault();
    var url = btn.getAttribute("data-url") || "";
    if(!url) return;
    copyText(url).then(function(){
      toast("文章链接已复制，可直接分享");
    });
  }, true);
})();
</script>