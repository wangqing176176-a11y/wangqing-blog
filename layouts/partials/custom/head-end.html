<script>
document.addEventListener("DOMContentLoaded", function () {
  // ä»…é¦–é¡µ
  var path = location.pathname || "/";
  var isHome = (path === "/" || path === "/index.html");
  if (!isHome) return;

  // é¦–æ¬¡è®¿é—® keyï¼ˆéœ€è¦é‡å¼¹æ—¶æ”¹è¿™ä¸ªç‰ˆæœ¬å·ï¼‰
  var KEY = "wq_first_visit_modal_v1";

  if (localStorage.getItem(KEY) === "1") return;

  var modal = document.getElementById("wqModal");
  var ok = document.getElementById("wqModalOk");
  var agree = document.getElementById("wqAgree");

  // ğŸš¨ é˜²å¾¡ï¼šä»»ä½•ä¸€ä¸ªæ²¡æ‹¿åˆ°éƒ½ä¸è¦ç»§ç»­
  if (!modal || !ok || !agree) {
    console.warn("[AccessModal] required elements missing");
    return;
  }

  // åˆå§‹ç¦ç”¨æŒ‰é’®
  ok.disabled = true;

  function show() {
    modal.style.display = "flex";
    requestAnimationFrame(function () {
      modal.classList.add("show");
    });
    modal.setAttribute("aria-hidden", "false");
    document.documentElement.style.overflow = "hidden";
  }

  function hide() {
    if (!agree.checked) {
      // ğŸ‘‡ è½»å¾®â€œæ‹’ç»åé¦ˆâ€ï¼ˆè§†è§‰ï¼Œä¸æ˜¯éŸ³æ•ˆï¼‰
      modal.classList.remove("show");
      modal.offsetWidth; // reflow
      modal.classList.add("show");
      return;
    }

    modal.classList.remove("show");
    modal.setAttribute("aria-hidden", "true");
    document.documentElement.style.overflow = "";

    setTimeout(function () {
      modal.style.display = "none";
    }, 200);

    localStorage.setItem(KEY, "1");
  }

  // å‹¾é€‰åæ‰å…è®¸è¿›å…¥
  agree.addEventListener("change", function () {
    ok.disabled = !agree.checked;
  });

  ok.addEventListener("click", hide);

  // é˜²ç»•è¿‡ï¼šç‚¹é®ç½© / ESC éƒ½èµ°åŒä¸€é€»è¾‘
  modal.addEventListener("click", function (e) {
    if (e.target === modal) hide();
  });

  document.addEventListener("keydown", function (e) {
    if (e.key === "Escape") hide();
  });

  // ğŸš€ æœ€åæ‰æ˜¾ç¤º
  show();
});
</script>
